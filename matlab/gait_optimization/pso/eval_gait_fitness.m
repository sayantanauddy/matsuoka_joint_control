function [ fitness ] = eval_gait_fitness( indiv )
%EVAL_GAIT_FITNESS Evaluates the fitness of an individual generated by the PSO
%   Detailed explanation goes here

    % Global oscillators
    global l1 l2 l3 l4 l5 r1 r2 r3 r4 r5;

    % Variables required to calculate the time delta
    global time_prev time_now;
    time_prev = 0;
    time_now = 0;

    % Variable which controls when the oscillator couplings are switched on
    global coupling_start_time coupling_on;
    coupling_on = false;
    
    % Time at which the robot joints are activated
    global joint_start_time;

    % Construct the oscillator network from the indiv vector
    [ l1, l2, l3, l4, l5, r1, r2, r3, r4, r5, coupling_start_time, joint_start_time ] = extract_network( indiv );

    % Set the time steps
    global time_vector;
    t = time_vector;

    % Use custom ODE solver which uses fixed time steps
    % Matlab's in-built ODE solver uses variable time steps and sometimes goes
    % back in time to adjust the time step. This causes problems in the state
    % variables of the matsuoka oscillator.
    
    % TO-DO        
    % Try
    y=ode1(@inertial_ode,t,[ 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 ]);
    % Catch
        % Log message: Robot has fallen
        
    % Check robot distance, multiply by -1 and return as fitness
    
    figure;
    % Plot the results
    hold on;
    plot(1);
    p1 = plot(t,y(:,1));
    p3 = plot(t,y(:,3));
    p5 = plot(t,y(:,5));
    p7 = plot(t,y(:,7));
    p9 = plot(t,y(:,9));
    p11 = plot(t,y(:,11));
    %p13 = plot(t,y(:,13));
    %p15 = plot(t,y(:,15));
    %p17 = plot(t,y(:,17));
    %p19 = plot(t,y(:,19));
    p1(1).LineWidth = 2;
    p3(1).LineWidth = 2;
    p5(1).LineWidth = 2;
    p7(1).LineWidth = 2;
    p9(1).LineWidth = 2;
    p11(1).LineWidth = 2;
    %p13(1).LineWidth = 2;
    %p15(1).LineWidth = 2;
    %p17(1).LineWidth = 2;
    %p19(1).LineWidth = 2;
    xlabel('time (s)');
    ylabel('joint angle (rad)');
    hold off;
    legend([p1,p3,p5,p7,p9,p11],'l1','l2','l3','l4','l5','r1');
    set(gca,'fontsize',20);
 
    fitness = rand(1,1);
end

